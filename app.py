# Streamlitライブラリのインポート
import streamlit as st

# ==========================================
# アプリのタイトル表示
# ==========================================
st.title("サンプルアプリ②: 少し複雑なWebアプリ")

# ==========================================
# アプリの説明文を表示
# ==========================================
# 文字数カウント機能の説明（Markdown形式で見出しとして表示）
st.write("##### 動作モード1: 文字数カウント")
st.write("入力フォームにテキストを入力し、「実行」ボタンを押すことで文字数をカウントできます。")
# BMI計算機能の説明
st.write("##### 動作モード2: BMI値の計算")
st.write("身長と体重を入力することで、肥満度を表す体型指数のBMI値を算出できます。")

# ==========================================
# ユーザーに動作モードを選択させるラジオボタン
# ==========================================
# st.radio()でラジオボタンを作成し、選択された値をselected_itemに格納
selected_item = st.radio(
    "動作モードを選択してください。",
    ["文字数カウント", "BMI値の計算"]
)

# 区切り線を表示（視覚的な区切り）
st.divider()

# ==========================================
# 選択されたモードに応じて入力フィールドを表示
# ==========================================
if selected_item == "文字数カウント":
    # テキスト入力フィールドを表示（入力された文字列はinput_messageに格納）
    input_message = st.text_input(label="文字数のカウント対象となるテキストを入力してください。")
    # 入力された文字列の長さ（文字数）を計算
    text_count = len(input_message)

else:
    # BMI計算モードが選択された場合
    # 身長の入力フィールド（cm単位）
    height = st.text_input(label="身長（cm）を入力してください。")
    # 体重の入力フィールド（kg単位）
    weight = st.text_input(label="体重（kg）を入力してください。")

# ==========================================
# 「実行」ボタンが押されたときの処理
# ==========================================
if st.button("実行"):
    st.divider()

    if selected_item == "文字数カウント":
        # テキストが入力されているかチェック
        if input_message:
            # 文字数を太字（**）で表示
            st.write(f"文字数: **{text_count}**")

        else:
            # エラーメッセージを表示（赤色で表示される）
            st.error("カウント対象となるテキストを入力してから「実行」ボタンを押してください。")

    else:
        # BMI計算モードの場合
        # 身長と体重の両方が入力されているかチェック
        if height and weight:
            try:
                # BMIの計算式: BMI = 体重(kg) / (身長(m))²
                # 身長はcmで入力されるため、100で割ってmに変換
                # round()で小数点第1位までに丸める
                bmi = round(int(weight) / ((int(height)/100) ** 2), 1)
                # BMI値を表示
                st.write(f"BMI値: {bmi}")

            except ValueError as e:
                # 数値に変換できない場合のエラーハンドリング
                # （例: 文字列が入力された場合）
                st.error("身長と体重は数値で入力してください。")

        else:
            # 身長または体重が未入力の場合のエラーメッセージ
            st.error("身長と体重をどちらも入力してください。")